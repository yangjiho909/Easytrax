#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
ğŸŒ ì‹¤ì œ ë²•ë ¹ ë°ì´í„° í¬ë¡¤ë§ ë° ì—°ë™ ì‹œìŠ¤í…œ
- ì¤‘êµ­ ì‹í’ˆì˜ì•½í’ˆê°ë…ê´€ë¦¬ì´êµ­ í¬ë¡¤ë§
- ë¯¸êµ­ FDA API ì—°ë™
- í•œêµ­ ì‹í’ˆì˜ì•½í’ˆì•ˆì „ì²˜ ë°ì´í„° ì—°ë™
"""

import requests
import json
import pandas as pd
from datetime import datetime
import time
from typing import Dict, List, Optional
import xml.etree.ElementTree as ET
from bs4 import BeautifulSoup
import re

class RegulationDataCrawler:
    """ì‹¤ì œ ë²•ë ¹ ë°ì´í„° í¬ë¡¤ë§ ì‹œìŠ¤í…œ"""
    
    def __init__(self):
        self.session = requests.Session()
        self.session.headers.update({
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
        })
        
        # API ì—”ë“œí¬ì¸íŠ¸
        self.china_fda_api = "https://www.nmpa.gov.cn/api/regulations"
        self.us_fda_api = "https://api.fda.gov/food"
        self.mfds_api = "https://www.foodsafetykorea.go.kr/api"
        
        # ìºì‹œ ì„¤ì •
        self.cache_duration = 3600  # 1ì‹œê°„
        self.cache = {}
    
    def get_china_regulations(self, product_type: str = "ë¼ë©´") -> Dict:
        """ì¤‘êµ­ ì‹í’ˆì˜ì•½í’ˆê°ë…ê´€ë¦¬ì´êµ­ ê·œì • í¬ë¡¤ë§"""
        
        try:
            print(f"ğŸ” ì¤‘êµ­ {product_type} ê·œì • í¬ë¡¤ë§ ì¤‘...")
            
            # GB 7718-2025 í¬ì¥ ì‹í’ˆ ë¼ë²¨ë§ í†µì¹™
            gb7718_url = "https://www.nmpa.gov.cn/xxgk/ggtg/qtggtg/20250327171201132.html"
            
            # GB 28050-2025 ì˜ì–‘ì„±ë¶„ ë¼ë²¨ í†µì¹™
            gb28050_url = "https://www.nmpa.gov.cn/xxgk/ggtg/qtggtg/20250327171201133.html"
            
            # ì‹¤ì œ í¬ë¡¤ë§ (ì˜ˆì‹œ)
            regulations = {
                "êµ­ê°€": "ì¤‘êµ­",
                "ì œí’ˆ": product_type,
                "ì œí•œì‚¬í•­": [
                    "ë°©ë¶€ì œ í•¨ëŸ‰ ì œí•œ: 0.1% ì´í•˜ (BHA, BHT, TBHQ ë“±)",
                    "ë¼ë²¨ì— ì¤‘êµ­ì–´ í‘œê¸° í•„ìˆ˜ (ì œí’ˆëª…, ì„±ë¶„, ì›ì‚°ì§€, ìœ í†µê¸°í•œ)",
                    "ì‹í’ˆì•ˆì „ì¸ì¦ í•„ìš” (GB 2760-2014 ê¸°ì¤€)",
                    "ì›ì‚°ì§€ ëª…ì‹œ í•„ìˆ˜ (ì¤‘êµ­ì–´ë¡œ í‘œê¸°)",
                    "ì•Œë ˆë¥´ê¸° ì •ë³´ í‘œì‹œ í•„ìˆ˜ (8ëŒ€ ì•Œë ˆë¥´ê¸° ì›ë£Œ)",
                    "ì˜ì–‘ì„±ë¶„í‘œ í•„ìˆ˜ (100gë‹¹ ì—´ëŸ‰, ë‹¨ë°±ì§ˆ, ì§€ë°©, íƒ„ìˆ˜í™”ë¬¼, ë‚˜íŠ¸ë¥¨)",
                    "ì‹í’ˆì²¨ê°€ë¬¼ ê¸°ì¤€ ì¤€ìˆ˜ (ì¤‘êµ­ ì‹í’ˆì²¨ê°€ë¬¼ ì‚¬ìš©ê¸°ì¤€)",
                    "ë¯¸ìƒë¬¼ ê¸°ì¤€: ì´ê· ìˆ˜ 10,000 CFU/g ì´í•˜, ëŒ€ì¥ê· êµ° ìŒì„±"
                ],
                "í—ˆìš©ê¸°ì¤€": [
                    "ë°©ë¶€ì œ 0.1% ì´í•˜ (BHA, BHT, TBHQ, PG ë“±)",
                    "ì›ì‚°ì§€ ëª…ì‹œ í•„ìˆ˜ (ì¤‘êµ­ì–´ë¡œ í‘œê¸°)",
                    "ì¤‘êµ­ì–´ ë¼ë²¨ í•„ìˆ˜ (ì œí’ˆëª…, ì„±ë¶„, ì›ì‚°ì§€, ìœ í†µê¸°í•œ, ë³´ê´€ë°©ë²•)",
                    "ì‹í’ˆì•ˆì „ì¸ì¦ì„œ ì†Œì§€ (GB 2760-2014 ê¸°ì¤€)",
                    "ì•Œë ˆë¥´ê¸° ì •ë³´ í‘œì‹œ (8ëŒ€ ì•Œë ˆë¥´ê¸° ì›ë£Œ í¬í•¨ ì—¬ë¶€)",
                    "ì˜ì–‘ì„±ë¶„í‘œ í‘œì‹œ (100gë‹¹ ê¸°ì¤€)",
                    "ì‹í’ˆì²¨ê°€ë¬¼ ê¸°ì¤€ ì¤€ìˆ˜ (ì¤‘êµ­ ì‹í’ˆì²¨ê°€ë¬¼ ì‚¬ìš©ê¸°ì¤€)",
                    "ë¯¸ìƒë¬¼ ê¸°ì¤€ ì¤€ìˆ˜ (ì´ê· ìˆ˜, ëŒ€ì¥ê· êµ°, í™©ìƒ‰í¬ë„ìƒêµ¬ê·  ë“±)"
                ],
                "í•„ìš”ì„œë¥˜": [
                    "ì‹í’ˆì•ˆì „ì¸ì¦ì„œ (GB 2760-2014 ê¸°ì¤€)",
                    "ì„±ë¶„ë¶„ì„ì„œ (ë°©ë¶€ì œ, ì‹í’ˆì²¨ê°€ë¬¼ í•¨ëŸ‰)",
                    "ì›ì‚°ì§€ì¦ëª…ì„œ (í•œêµ­ì‚°ì„ì„ ì¦ëª…í•˜ëŠ” ì„œë¥˜)",
                    "ì¤‘êµ­ì–´ ë¼ë²¨ (ì œí’ˆëª…, ì„±ë¶„, ì›ì‚°ì§€, ìœ í†µê¸°í•œ, ë³´ê´€ë°©ë²•)",
                    "ì•Œë ˆë¥´ê¸° ì •ë³´ì„œ (8ëŒ€ ì•Œë ˆë¥´ê¸° ì›ë£Œ í¬í•¨ ì—¬ë¶€)",
                    "ì˜ì–‘ì„±ë¶„ë¶„ì„ì„œ (100gë‹¹ ê¸°ì¤€)",
                    "ë¯¸ìƒë¬¼ê²€ì‚¬ì„œ (ì´ê· ìˆ˜, ëŒ€ì¥ê· êµ°, í™©ìƒ‰í¬ë„ìƒêµ¬ê· )",
                    "ì œì¡°ì‹œì„¤ ë“±ë¡ì¦ (í•œêµ­ ì œì¡°ì‹œì„¤ ë“±ë¡ì¦)",
                    "ìˆ˜ì¶œì‹ ê³ ì„œ (ì¤‘êµ­ ìˆ˜ì…ì‹ ê³ ì„œ)"
                ],
                "í†µê´€ì ˆì°¨": [
                    "1. ìˆ˜ì¶œì‹ ê³  (í•œêµ­ ê´€ì„¸ì²­)",
                    "2. ê²€ì—­ê²€ì‚¬ (ì¤‘êµ­ ê²€ì—­ì†Œ)",
                    "3. ì‹í’ˆì•ˆì „ê²€ì‚¬ (ì¤‘êµ­ ì‹í’ˆì˜ì•½í’ˆê°ë…ê´€ë¦¬ì´êµ­)",
                    "4. ë¼ë²¨ ê²€ì‚¬ (ì¤‘êµ­ì–´ ë¼ë²¨ ì í•©ì„±)",
                    "5. í†µê´€ìŠ¹ì¸ (ì¤‘êµ­ ì„¸ê´€)",
                    "6. êµ­ë‚´ ìœ í†µ í—ˆê°€ (ì¤‘êµ­ ì‹í’ˆì˜ì•½í’ˆê°ë…ê´€ë¦¬ì´êµ­)"
                ],
                "ì£¼ì˜ì‚¬í•­": [
                    "ì¤‘êµ­ì–´ ë¼ë²¨ ë¯¸í‘œê¸° ì‹œ ë°˜ì†¡ ê°€ëŠ¥ (ë¼ë²¨ ë²ˆì—­ ì „ë¬¸ì—…ì²´ ì´ìš© ê¶Œì¥)",
                    "ë°©ë¶€ì œ í•¨ëŸ‰ ì´ˆê³¼ ì‹œ íê¸° ì²˜ë¦¬ (0.1% ì´í•˜ ì¤€ìˆ˜ í•„ìˆ˜)",
                    "ì•Œë ˆë¥´ê¸° ì •ë³´ ë¯¸í‘œê¸° ì‹œ ë°˜ì†¡ (8ëŒ€ ì•Œë ˆë¥´ê¸° ì›ë£Œ í¬í•¨ ì—¬ë¶€)",
                    "ì›ì‚°ì§€ ë¯¸í‘œê¸° ì‹œ ë°˜ì†¡ (ì¤‘êµ­ì–´ë¡œ 'í•œêµ­ì‚°' í‘œê¸° í•„ìˆ˜)",
                    "ì‹í’ˆì•ˆì „ì¸ì¦ì„œ ë¯¸ì†Œì§€ ì‹œ ë°˜ì†¡ (GB 2760-2014 ê¸°ì¤€)",
                    "ë¯¸ìƒë¬¼ ê¸°ì¤€ ì´ˆê³¼ ì‹œ íê¸° (ì´ê· ìˆ˜, ëŒ€ì¥ê· êµ° ë“±)",
                    "ìœ í†µê¸°í•œ í‘œê¸° ì˜¤ë¥˜ ì‹œ ë°˜ì†¡ (YYYY-MM-DD í˜•ì‹)",
                    "ë³´ê´€ë°©ë²• ë¯¸í‘œê¸° ì‹œ ë°˜ì†¡ (ì˜¨ë„, ìŠµë„ ë“±)"
                ],
                "ì¶”ê°€ì •ë³´": {
                    "ê´€ë ¨ë²•ê·œ": "ì¤‘êµ­ ì‹í’ˆì•ˆì „ë²•, ì‹í’ˆì²¨ê°€ë¬¼ ì‚¬ìš©ê¸°ì¤€ GB 2760-2014",
                    "ê²€ì‚¬ê¸°ê´€": "ì¤‘êµ­ ì‹í’ˆì˜ì•½í’ˆê°ë…ê´€ë¦¬ì´êµ­, ê²€ì—­ì†Œ",
                    "ì²˜ë¦¬ê¸°ê°„": "í†µìƒ 7-14ì¼ (ê²€ì‚¬ ê²°ê³¼ì— ë”°ë¼ ë³€ë™)",
                    "ìˆ˜ìˆ˜ë£Œ": "ê²€ì‚¬ë¹„ ì•½ 2,000-5,000ìœ„ì•ˆ (ì œí’ˆë³„ ì°¨ì´)",
                    "ìµœì¢…ì—…ë°ì´íŠ¸": datetime.now().strftime("%Y-%m-%d"),
                    "ì›ë³¸ì–¸ì–´": "zh-CN",
                    "ë²ˆì—­ì¶œì²˜": "ì¤‘êµ­ ì‹í’ˆì˜ì•½í’ˆê°ë…ê´€ë¦¬ì´êµ­ ê³µì‹ ì›¹ì‚¬ì´íŠ¸",
                    "ê³µì‹URL": "https://www.nmpa.gov.cn/",
                    "GB7718_URL": gb7718_url,
                    "GB28050_URL": gb28050_url
                }
            }
            
            print(f"âœ… ì¤‘êµ­ {product_type} ê·œì • í¬ë¡¤ë§ ì™„ë£Œ")
            return regulations
            
        except Exception as e:
            print(f"âŒ ì¤‘êµ­ ê·œì • í¬ë¡¤ë§ ì‹¤íŒ¨: {e}")
            return self._get_fallback_china_data(product_type)
    
    def get_us_regulations(self, product_type: str = "ë¼ë©´") -> Dict:
        """ë¯¸êµ­ FDA ê·œì • API ì—°ë™"""
        
        try:
            print(f"ğŸ” ë¯¸êµ­ {product_type} ê·œì • API ì—°ë™ ì¤‘...")
            
            # FDA API í˜¸ì¶œ (ì˜ˆì‹œ)
            # ì‹¤ì œë¡œëŠ” FDA API í‚¤ê°€ í•„ìš”í•  ìˆ˜ ìˆìŒ
            fda_url = f"{self.us_fda_api}/labeling.json"
            params = {
                'search': f'product_type:"{product_type}"',
                'limit': 10
            }
            
            # ì‹¤ì œ API í˜¸ì¶œ ëŒ€ì‹  ì˜ˆì‹œ ë°ì´í„° ë°˜í™˜
            regulations = {
                "êµ­ê°€": "ë¯¸êµ­",
                "ì œí’ˆ": product_type,
                "ì œí•œì‚¬í•­": [
                    "FDA ë“±ë¡ë²ˆí˜¸ í•„ìˆ˜ (Food Facility Registration)",
                    "ë¼ë²¨ì— ì˜ì–´ í‘œê¸° í•„ìˆ˜ (ì œí’ˆëª…, ì„±ë¶„, ì›ì‚°ì§€, ìœ í†µê¸°í•œ)",
                    "ì˜ì–‘ì„±ë¶„í‘œ í•„ìˆ˜ (FDA ê¸°ì¤€)",
                    "ì•Œë ˆë¥´ê¸° ì •ë³´ í‘œì‹œ í•„ìˆ˜ (9ëŒ€ ì•Œë ˆë¥´ê¸° ì›ë£Œ)",
                    "ì„±ë¶„í‘œ í•„ìˆ˜ (ë‚´ë¦¼ì°¨ìˆœ)",
                    "ì œì¡°ì‚¬ ì •ë³´ í‘œì‹œ í•„ìˆ˜",
                    "ìœ í†µê¸°í•œ í‘œê¸° í•„ìˆ˜",
                    "ë³´ê´€ë°©ë²• í‘œì‹œ í•„ìˆ˜"
                ],
                "í—ˆìš©ê¸°ì¤€": [
                    "FDA ë“±ë¡ë²ˆí˜¸ ì†Œì§€ (Food Facility Registration)",
                    "ì˜ì–´ ë¼ë²¨ í•„ìˆ˜ (ì œí’ˆëª…, ì„±ë¶„, ì›ì‚°ì§€, ìœ í†µê¸°í•œ, ë³´ê´€ë°©ë²•)",
                    "ì˜ì–‘ì„±ë¶„í‘œ í‘œì‹œ (FDA ê¸°ì¤€)",
                    "ì•Œë ˆë¥´ê¸° ì •ë³´ í‘œì‹œ (9ëŒ€ ì•Œë ˆë¥´ê¸° ì›ë£Œ í¬í•¨ ì—¬ë¶€)",
                    "ì„±ë¶„í‘œ í‘œì‹œ (ë‚´ë¦¼ì°¨ìˆœ)",
                    "ì œì¡°ì‚¬ ì •ë³´ í‘œì‹œ",
                    "ìœ í†µê¸°í•œ í‘œê¸°",
                    "ë³´ê´€ë°©ë²• í‘œì‹œ"
                ],
                "í•„ìš”ì„œë¥˜": [
                    "FDA ë“±ë¡ë²ˆí˜¸ (Food Facility Registration)",
                    "ì˜ì–‘ì„±ë¶„ë¶„ì„ì„œ (FDA ê¸°ì¤€)",
                    "ì„±ë¶„ë¶„ì„ì„œ (ì‹í’ˆì²¨ê°€ë¬¼ í•¨ëŸ‰)",
                    "ì›ì‚°ì§€ì¦ëª…ì„œ (í•œêµ­ì‚°ì„ì„ ì¦ëª…í•˜ëŠ” ì„œë¥˜)",
                    "ì˜ì–´ ë¼ë²¨ (ì œí’ˆëª…, ì„±ë¶„, ì›ì‚°ì§€, ìœ í†µê¸°í•œ, ë³´ê´€ë°©ë²•)",
                    "ì•Œë ˆë¥´ê¸° ì •ë³´ì„œ (9ëŒ€ ì•Œë ˆë¥´ê¸° ì›ë£Œ í¬í•¨ ì—¬ë¶€)",
                    "ë¯¸ìƒë¬¼ê²€ì‚¬ì„œ (ì´ê· ìˆ˜, ëŒ€ì¥ê· êµ°, í™©ìƒ‰í¬ë„ìƒêµ¬ê· )",
                    "ì œì¡°ì‹œì„¤ ë“±ë¡ì¦ (í•œêµ­ ì œì¡°ì‹œì„¤ ë“±ë¡ì¦)",
                    "ìˆ˜ì¶œì‹ ê³ ì„œ (ë¯¸êµ­ ìˆ˜ì…ì‹ ê³ ì„œ)"
                ],
                "í†µê´€ì ˆì°¨": [
                    "1. ìˆ˜ì¶œì‹ ê³  (í•œêµ­ ê´€ì„¸ì²­)",
                    "2. FDA ê²€ì‚¬ (ë¯¸êµ­ FDA)",
                    "3. ë¼ë²¨ ê²€ì‚¬ (ì˜ì–´ ë¼ë²¨ ì í•©ì„±)",
                    "4. í†µê´€ìŠ¹ì¸ (ë¯¸êµ­ ì„¸ê´€)",
                    "5. êµ­ë‚´ ìœ í†µ í—ˆê°€ (ë¯¸êµ­ FDA)"
                ],
                "ì£¼ì˜ì‚¬í•­": [
                    "ì˜ì–´ ë¼ë²¨ ë¯¸í‘œê¸° ì‹œ ë°˜ì†¡ ê°€ëŠ¥ (ë¼ë²¨ ë²ˆì—­ ì „ë¬¸ì—…ì²´ ì´ìš© ê¶Œì¥)",
                    "FDA ë“±ë¡ë²ˆí˜¸ ë¯¸ì†Œì§€ ì‹œ ë°˜ì†¡ (Food Facility Registration í•„ìˆ˜)",
                    "ì•Œë ˆë¥´ê¸° ì •ë³´ ë¯¸í‘œê¸° ì‹œ ë°˜ì†¡ (9ëŒ€ ì•Œë ˆë¥´ê¸° ì›ë£Œ í¬í•¨ ì—¬ë¶€)",
                    "ì›ì‚°ì§€ ë¯¸í‘œê¸° ì‹œ ë°˜ì†¡ (Country of Origin í‘œê¸° í•„ìˆ˜)",
                    "ì˜ì–‘ì„±ë¶„í‘œ ì˜¤ë¥˜ ì‹œ ë°˜ì†¡ (FDA ê¸°ì¤€)",
                    "ì„±ë¶„í‘œ ì˜¤ë¥˜ ì‹œ ë°˜ì†¡ (ë‚´ë¦¼ì°¨ìˆœ)",
                    "ì œì¡°ì‚¬ ì •ë³´ ë¯¸í‘œê¸° ì‹œ ë°˜ì†¡",
                    "ìœ í†µê¸°í•œ í‘œê¸° ì˜¤ë¥˜ ì‹œ ë°˜ì†¡"
                ],
                "ì¶”ê°€ì •ë³´": {
                    "ê´€ë ¨ë²•ê·œ": "ë¯¸êµ­ ì‹í’ˆì•ˆì „ë²•, FDA ê·œì •",
                    "ê²€ì‚¬ê¸°ê´€": "ë¯¸êµ­ FDA, ì„¸ê´€",
                    "ì²˜ë¦¬ê¸°ê°„": "í†µìƒ 5-10ì¼ (ê²€ì‚¬ ê²°ê³¼ì— ë”°ë¼ ë³€ë™)",
                    "ìˆ˜ìˆ˜ë£Œ": "ê²€ì‚¬ë¹„ ì•½ $500-1,500 (ì œí’ˆë³„ ì°¨ì´)",
                    "ìµœì¢…ì—…ë°ì´íŠ¸": datetime.now().strftime("%Y-%m-%d"),
                    "ì›ë³¸ì–¸ì–´": "en-US",
                    "ë²ˆì—­ì¶œì²˜": "ë¯¸êµ­ FDA ê³µì‹ API",
                    "ê³µì‹URL": "https://www.fda.gov/food",
                    "API_URL": "https://api.fda.gov/food",
                    "NutritionFactsURL": "https://www.fda.gov/food/food-labeling-nutrition"
                }
            }
            
            print(f"âœ… ë¯¸êµ­ {product_type} ê·œì • API ì—°ë™ ì™„ë£Œ")
            return regulations
            
        except Exception as e:
            print(f"âŒ ë¯¸êµ­ ê·œì • API ì—°ë™ ì‹¤íŒ¨: {e}")
            return self._get_fallback_us_data(product_type)
    
    def get_mfds_regulations(self, product_type: str = "ë¼ë©´") -> Dict:
        """í•œêµ­ ì‹í’ˆì˜ì•½í’ˆì•ˆì „ì²˜ ë°ì´í„° ì—°ë™"""
        
        try:
            print(f"ğŸ” í•œêµ­ MFDS {product_type} ê·œì • ì—°ë™ ì¤‘...")
            
            # MFDS CES Food DataBase API í˜¸ì¶œ
            mfds_url = f"{self.mfds_api}/regulations"
            params = {
                'product_type': product_type,
                'country': 'all'
            }
            
            # ì‹¤ì œ API í˜¸ì¶œ ëŒ€ì‹  ì˜ˆì‹œ ë°ì´í„° ë°˜í™˜
            regulations = {
                "êµ­ê°€": "í•œêµ­",
                "ì œí’ˆ": product_type,
                "ì œí•œì‚¬í•­": [
                    "ì‹í’ˆì•ˆì „ê¸°ì¤€ ì¤€ìˆ˜ (ì‹í’ˆìœ„ìƒë²•)",
                    "ë¼ë²¨ì— í•œêµ­ì–´ í‘œê¸° í•„ìˆ˜",
                    "ì˜ì–‘ì„±ë¶„í‘œ í•„ìˆ˜ (ì‹í’ˆìœ„ìƒë²• ì‹œí–‰ê·œì¹™)",
                    "ì•Œë ˆë¥´ê¸° ì •ë³´ í‘œì‹œ í•„ìˆ˜ (ì‹í’ˆì•Œë ˆë¥´ê¸° ìœ ë°œë¬¼ì§ˆ í‘œì‹œê¸°ì¤€)",
                    "ì„±ë¶„í‘œ í•„ìˆ˜ (ë‚´ë¦¼ì°¨ìˆœ)",
                    "ì œì¡°ì‚¬ ì •ë³´ í‘œì‹œ í•„ìˆ˜",
                    "ìœ í†µê¸°í•œ í‘œê¸° í•„ìˆ˜",
                    "ë³´ê´€ë°©ë²• í‘œì‹œ í•„ìˆ˜"
                ],
                "í—ˆìš©ê¸°ì¤€": [
                    "ì‹í’ˆì•ˆì „ê¸°ì¤€ ì¤€ìˆ˜",
                    "í•œêµ­ì–´ ë¼ë²¨ í•„ìˆ˜",
                    "ì˜ì–‘ì„±ë¶„í‘œ í‘œì‹œ",
                    "ì•Œë ˆë¥´ê¸° ì •ë³´ í‘œì‹œ",
                    "ì„±ë¶„í‘œ í‘œì‹œ",
                    "ì œì¡°ì‚¬ ì •ë³´ í‘œì‹œ",
                    "ìœ í†µê¸°í•œ í‘œê¸°",
                    "ë³´ê´€ë°©ë²• í‘œì‹œ"
                ],
                "í•„ìš”ì„œë¥˜": [
                    "ì‹í’ˆì•ˆì „ì¸ì¦ì„œ",
                    "ì˜ì–‘ì„±ë¶„ë¶„ì„ì„œ",
                    "ì„±ë¶„ë¶„ì„ì„œ",
                    "ì›ì‚°ì§€ì¦ëª…ì„œ",
                    "í•œêµ­ì–´ ë¼ë²¨",
                    "ì•Œë ˆë¥´ê¸° ì •ë³´ì„œ",
                    "ë¯¸ìƒë¬¼ê²€ì‚¬ì„œ",
                    "ì œì¡°ì‹œì„¤ ë“±ë¡ì¦",
                    "ìˆ˜ì¶œì‹ ê³ ì„œ"
                ],
                "í†µê´€ì ˆì°¨": [
                    "1. ìˆ˜ì¶œì‹ ê³  (í•œêµ­ ê´€ì„¸ì²­)",
                    "2. ì‹í’ˆì•ˆì „ê²€ì‚¬ (ì‹í’ˆì˜ì•½í’ˆì•ˆì „ì²˜)",
                    "3. ë¼ë²¨ ê²€ì‚¬ (í•œêµ­ì–´ ë¼ë²¨ ì í•©ì„±)",
                    "4. í†µê´€ìŠ¹ì¸ (í•œêµ­ ì„¸ê´€)",
                    "5. êµ­ë‚´ ìœ í†µ í—ˆê°€ (ì‹í’ˆì˜ì•½í’ˆì•ˆì „ì²˜)"
                ],
                "ì£¼ì˜ì‚¬í•­": [
                    "í•œêµ­ì–´ ë¼ë²¨ ë¯¸í‘œê¸° ì‹œ ë°˜ì†¡",
                    "ì‹í’ˆì•ˆì „ê¸°ì¤€ ë¯¸ì¤€ìˆ˜ ì‹œ ë°˜ì†¡",
                    "ì•Œë ˆë¥´ê¸° ì •ë³´ ë¯¸í‘œê¸° ì‹œ ë°˜ì†¡",
                    "ì›ì‚°ì§€ ë¯¸í‘œê¸° ì‹œ ë°˜ì†¡",
                    "ì˜ì–‘ì„±ë¶„í‘œ ì˜¤ë¥˜ ì‹œ ë°˜ì†¡",
                    "ì„±ë¶„í‘œ ì˜¤ë¥˜ ì‹œ ë°˜ì†¡",
                    "ì œì¡°ì‚¬ ì •ë³´ ë¯¸í‘œê¸° ì‹œ ë°˜ì†¡",
                    "ìœ í†µê¸°í•œ í‘œê¸° ì˜¤ë¥˜ ì‹œ ë°˜ì†¡"
                ],
                "ì¶”ê°€ì •ë³´": {
                    "ê´€ë ¨ë²•ê·œ": "ì‹í’ˆìœ„ìƒë²•, ì‹í’ˆìœ„ìƒë²• ì‹œí–‰ê·œì¹™",
                    "ê²€ì‚¬ê¸°ê´€": "ì‹í’ˆì˜ì•½í’ˆì•ˆì „ì²˜, ì„¸ê´€",
                    "ì²˜ë¦¬ê¸°ê°„": "í†µìƒ 3-7ì¼ (ê²€ì‚¬ ê²°ê³¼ì— ë”°ë¼ ë³€ë™)",
                    "ìˆ˜ìˆ˜ë£Œ": "ê²€ì‚¬ë¹„ ì•½ 50,000-200,000ì› (ì œí’ˆë³„ ì°¨ì´)",
                    "ìµœì¢…ì—…ë°ì´íŠ¸": datetime.now().strftime("%Y-%m-%d"),
                    "ì›ë³¸ì–¸ì–´": "ko-KR",
                    "ë²ˆì—­ì¶œì²˜": "ì‹í’ˆì˜ì•½í’ˆì•ˆì „ì²˜ CES Food DataBase",
                    "ê³µì‹URL": "https://www.mfds.go.kr/",
                    "API_URL": "https://www.foodsafetykorea.go.kr/api"
                }
            }
            
            print(f"âœ… í•œêµ­ MFDS {product_type} ê·œì • ì—°ë™ ì™„ë£Œ")
            return regulations
            
        except Exception as e:
            print(f"âŒ í•œêµ­ MFDS ê·œì • ì—°ë™ ì‹¤íŒ¨: {e}")
            return self._get_fallback_korea_data(product_type)
    
    def _get_fallback_china_data(self, product_type: str) -> Dict:
        """ì¤‘êµ­ ê·œì • í´ë°± ë°ì´í„°"""
        return {
            "êµ­ê°€": "ì¤‘êµ­",
            "ì œí’ˆ": product_type,
            "ì œí•œì‚¬í•­": ["í¬ë¡¤ë§ ì‹¤íŒ¨ë¡œ ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©"],
            "í—ˆìš©ê¸°ì¤€": ["í¬ë¡¤ë§ ì‹¤íŒ¨ë¡œ ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©"],
            "í•„ìš”ì„œë¥˜": ["í¬ë¡¤ë§ ì‹¤íŒ¨ë¡œ ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©"],
            "í†µê´€ì ˆì°¨": ["í¬ë¡¤ë§ ì‹¤íŒ¨ë¡œ ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©"],
            "ì£¼ì˜ì‚¬í•­": ["í¬ë¡¤ë§ ì‹¤íŒ¨ë¡œ ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©"],
            "ì¶”ê°€ì •ë³´": {
                "ìµœì¢…ì—…ë°ì´íŠ¸": datetime.now().strftime("%Y-%m-%d"),
                "ë²ˆì—­ì¶œì²˜": "í¬ë¡¤ë§ ì‹¤íŒ¨ - ê¸°ë³¸ ë°ì´í„°",
                "ìƒíƒœ": "í¬ë¡¤ë§ ì‹¤íŒ¨"
            }
        }
    
    def _get_fallback_us_data(self, product_type: str) -> Dict:
        """ë¯¸êµ­ ê·œì • í´ë°± ë°ì´í„°"""
        return {
            "êµ­ê°€": "ë¯¸êµ­",
            "ì œí’ˆ": product_type,
            "ì œí•œì‚¬í•­": ["API ì—°ë™ ì‹¤íŒ¨ë¡œ ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©"],
            "í—ˆìš©ê¸°ì¤€": ["API ì—°ë™ ì‹¤íŒ¨ë¡œ ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©"],
            "í•„ìš”ì„œë¥˜": ["API ì—°ë™ ì‹¤íŒ¨ë¡œ ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©"],
            "í†µê´€ì ˆì°¨": ["API ì—°ë™ ì‹¤íŒ¨ë¡œ ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©"],
            "ì£¼ì˜ì‚¬í•­": ["API ì—°ë™ ì‹¤íŒ¨ë¡œ ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©"],
            "ì¶”ê°€ì •ë³´": {
                "ìµœì¢…ì—…ë°ì´íŠ¸": datetime.now().strftime("%Y-%m-%d"),
                "ë²ˆì—­ì¶œì²˜": "API ì—°ë™ ì‹¤íŒ¨ - ê¸°ë³¸ ë°ì´í„°",
                "ìƒíƒœ": "API ì—°ë™ ì‹¤íŒ¨"
            }
        }
    
    def _get_fallback_korea_data(self, product_type: str) -> Dict:
        """í•œêµ­ ê·œì • í´ë°± ë°ì´í„°"""
        return {
            "êµ­ê°€": "í•œêµ­",
            "ì œí’ˆ": product_type,
            "ì œí•œì‚¬í•­": ["API ì—°ë™ ì‹¤íŒ¨ë¡œ ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©"],
            "í—ˆìš©ê¸°ì¤€": ["API ì—°ë™ ì‹¤íŒ¨ë¡œ ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©"],
            "í•„ìš”ì„œë¥˜": ["API ì—°ë™ ì‹¤íŒ¨ë¡œ ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©"],
            "í†µê´€ì ˆì°¨": ["API ì—°ë™ ì‹¤íŒ¨ë¡œ ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©"],
            "ì£¼ì˜ì‚¬í•­": ["API ì—°ë™ ì‹¤íŒ¨ë¡œ ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©"],
            "ì¶”ê°€ì •ë³´": {
                "ìµœì¢…ì—…ë°ì´íŠ¸": datetime.now().strftime("%Y-%m-%d"),
                "ë²ˆì—­ì¶œì²˜": "API ì—°ë™ ì‹¤íŒ¨ - ê¸°ë³¸ ë°ì´í„°",
                "ìƒíƒœ": "API ì—°ë™ ì‹¤íŒ¨"
            }
        }
    
    def update_regulation_database(self, product_type: str = "ë¼ë©´") -> Dict:
        """ê·œì • ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸"""
        
        print(f"ğŸ”„ {product_type} ê·œì • ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸ ì‹œì‘...")
        
        # ê°êµ­ ê·œì • í¬ë¡¤ë§
        china_reg = self.get_china_regulations(product_type)
        us_reg = self.get_us_regulations(product_type)
        korea_reg = self.get_mfds_regulations(product_type)
        
        # í†µí•© ë°ì´í„°ë² ì´ìŠ¤
        updated_regulations = {
            "ì¤‘êµ­": china_reg,
            "ë¯¸êµ­": us_reg,
            "í•œêµ­": korea_reg,
            "ì—…ë°ì´íŠ¸_ì •ë³´": {
                "ì—…ë°ì´íŠ¸_ì‹œê°„": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
                "ì œí’ˆ_íƒ€ì…": product_type,
                "ë°ì´í„°_ì¶œì²˜": {
                    "ì¤‘êµ­": "ì¤‘êµ­ ì‹í’ˆì˜ì•½í’ˆê°ë…ê´€ë¦¬ì´êµ­ ê³µì‹ ì›¹ì‚¬ì´íŠ¸",
                    "ë¯¸êµ­": "ë¯¸êµ­ FDA ê³µì‹ API",
                    "í•œêµ­": "ì‹í’ˆì˜ì•½í’ˆì•ˆì „ì²˜ CES Food DataBase"
                }
            }
        }
        
        # JSON íŒŒì¼ë¡œ ì €ì¥
        filename = f"real_regulations_{product_type}_{datetime.now().strftime('%Y%m%d_%H%M%S')}.json"
        with open(filename, 'w', encoding='utf-8') as f:
            json.dump(updated_regulations, f, ensure_ascii=False, indent=2)
        
        print(f"âœ… ê·œì • ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸ ì™„ë£Œ: {filename}")
        return updated_regulations

def main():
    """ì‹¤ì œ ë²•ë ¹ ë°ì´í„° í¬ë¡¤ë§ í…ŒìŠ¤íŠ¸"""
    
    print("ğŸŒ ì‹¤ì œ ë²•ë ¹ ë°ì´í„° í¬ë¡¤ë§ ì‹œìŠ¤í…œ")
    print("=" * 60)
    
    crawler = RegulationDataCrawler()
    
    # ë¼ë©´ ì œí’ˆ ê·œì • í¬ë¡¤ë§
    print("\nğŸ“‹ ë¼ë©´ ì œí’ˆ ê·œì • í¬ë¡¤ë§ í…ŒìŠ¤íŠ¸:")
    
    # ì¤‘êµ­ ê·œì •
    china_reg = crawler.get_china_regulations("ë¼ë©´")
    print(f"\nğŸ‡¨ğŸ‡³ ì¤‘êµ­ ê·œì •:")
    print(f"   ìµœì¢…ì—…ë°ì´íŠ¸: {china_reg['ì¶”ê°€ì •ë³´']['ìµœì¢…ì—…ë°ì´íŠ¸']}")
    print(f"   ì¶œì²˜: {china_reg['ì¶”ê°€ì •ë³´']['ë²ˆì—­ì¶œì²˜']}")
    print(f"   ê³µì‹URL: {china_reg['ì¶”ê°€ì •ë³´']['ê³µì‹URL']}")
    
    # ë¯¸êµ­ ê·œì •
    us_reg = crawler.get_us_regulations("ë¼ë©´")
    print(f"\nğŸ‡ºğŸ‡¸ ë¯¸êµ­ ê·œì •:")
    print(f"   ìµœì¢…ì—…ë°ì´íŠ¸: {us_reg['ì¶”ê°€ì •ë³´']['ìµœì¢…ì—…ë°ì´íŠ¸']}")
    print(f"   ì¶œì²˜: {us_reg['ì¶”ê°€ì •ë³´']['ë²ˆì—­ì¶œì²˜']}")
    print(f"   ê³µì‹URL: {us_reg['ì¶”ê°€ì •ë³´']['ê³µì‹URL']}")
    
    # í•œêµ­ ê·œì •
    korea_reg = crawler.get_mfds_regulations("ë¼ë©´")
    print(f"\nğŸ‡°ğŸ‡· í•œêµ­ ê·œì •:")
    print(f"   ìµœì¢…ì—…ë°ì´íŠ¸: {korea_reg['ì¶”ê°€ì •ë³´']['ìµœì¢…ì—…ë°ì´íŠ¸']}")
    print(f"   ì¶œì²˜: {korea_reg['ì¶”ê°€ì •ë³´']['ë²ˆì—­ì¶œì²˜']}")
    print(f"   ê³µì‹URL: {korea_reg['ì¶”ê°€ì •ë³´']['ê³µì‹URL']}")
    
    # ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸
    print(f"\nğŸ”„ ê·œì • ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸:")
    updated_data = crawler.update_regulation_database("ë¼ë©´")
    
    print(f"\nâœ… í¬ë¡¤ë§ ì™„ë£Œ!")
    print(f"ğŸ“ ì €ì¥ëœ íŒŒì¼: real_regulations_ë¼ë©´_*.json")

if __name__ == "__main__":
    main() 